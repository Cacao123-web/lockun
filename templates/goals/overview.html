{# templates/goals/overview.html #}
{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="mb-0">Tổng quan mục tiêu</h3>
  <a class="btn btn-success" href="{% url 'goals_create' %}">+ Thêm mục tiêu</a>
</div>

{# ==== HÀNG KPI TỔNG QUAN ==== #}
<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="border rounded p-3 text-center">
      <div class="small text-muted">Calories in</div>
      <div class="fs-4 fw-bold">
        {{ kpis.calories_in|default:0|floatformat:0 }} kcal
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="border rounded p-3 text-center">
      <div class="small text-muted">Calories out</div>
      <div class="fs-4 fw-bold">
        {{ kpis.calories_out|default:0|floatformat:0 }} kcal
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="border rounded p-3 text-center">
      <div class="small text-muted">Buổi tập</div>
      <div class="fs-4 fw-bold">
        {{ kpis.sessions|default:0 }}
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="border rounded p-3 text-center">
      <div class="small text-muted">Chuỗi ngày log</div>
      <div class="fs-4 fw-bold">
        {{ kpis.streak_days|default:0 }} ngày
      </div>
    </div>
  </div>
</div>

{# ==== MỤC TIÊU CỦA BẠN (ACTIVE GOAL) ==== #}
<h4 class="mb-3">Mục tiêu của bạn</h4>

{% if active_goal %}
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <p class="text-muted mb-1">Loại mục tiêu</p>
          <h5 class="fw-bold mb-3">{{ active_goal.get_type_display }}</h5>

          <p class="mb-1">
            <strong>Bắt đầu:</strong> {{ active_goal.start_date|date:"d/m/Y" }}
          </p>
          <p class="mb-1">
            <strong>Hạn:</strong> {{ active_goal.deadline|date:"d/m/Y" }}
          </p>
        </div>

        <div class="col-md-6">
          <p class="text-muted mb-1">Cân nặng mục tiêu</p>
          <h5 class="fw-bold mb-3">
            {{ active_goal.target_value }} kg
          </h5>

          <p class="mb-1">
            <strong>Tiến độ:</strong>
            {{ active_goal.progress_pct|default:0|floatformat:1 }}%
          </p>
          <div class="progress mb-2" style="height:8px;">
            <div class="progress-bar bg-success"
                 role="progressbar"
                 style="width: {{ active_goal.progress_pct|default:0 }}%;"
                 aria-valuenow="{{ active_goal.progress_pct|default:0 }}"
                 aria-valuemin="0"
                 aria-valuemax="100">
            </div>
          </div>

          {% if active_goal.progress_text %}
            <p class="small text-muted mb-0">{{ active_goal.progress_text }}</p>
          {% endif %}
        </div>
      </div>

      <hr>

      <div class="d-flex flex-wrap gap-2">
        <span class="badge bg-warning text-dark px-3 py-2">
          Đang thực hiện
        </span>
        <a href="{% url 'goals_finish' active_goal.id 'success' %}"
           class="btn btn-outline-success btn-sm">
          Hoàn thành
        </a>
        <a href="{% url 'goals_finish' active_goal.id 'fail' %}"
           class="btn btn-outline-secondary btn-sm">
          Kết thúc
        </a>
        <a href="{% url 'goals_delete' active_goal.id %}"
           class="btn btn-outline-danger btn-sm">
          Xóa
        </a>
      </div>
    </div>
  </div>
{% else %}
  <p class="text-muted">
    Bạn chưa có mục tiêu đang thực hiện.
    <a class="btn btn-success btn-sm ms-2" href="{% url 'goals_create' %}">
      + Thêm mục tiêu
    </a>
  </p>
{% endif %}

{# ==== DANH SÁCH TẤT CẢ MỤC TIÊU (LỊCH SỬ) ==== #}
<h4 class="mb-3">Lịch sử mục tiêu</h4>

<table class="table table-hover align-middle">
  <thead>
    <tr>
      <th>Loại</th>
      <th>Giá trị</th>
      <th>Bắt đầu</th>
      <th>Hạn</th>
      <th>Trạng thái</th>
    </tr>
  </thead>
  <tbody>
    {% for g in items %}
      <tr>
        <td>{{ g.get_type_display }}</td>
        <td>{{ g.target_value }}</td>
        <td>{{ g.start_date|date:"d/m/Y" }}</td>
        <td>{{ g.deadline|date:"d/m/Y" }}</td>
        <td>{{ g.get_status_display }}</td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="5" class="text-center text-muted">
          Chưa có mục tiêu nào.
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
